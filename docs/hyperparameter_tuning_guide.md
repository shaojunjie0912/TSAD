# SWIFT è¶…å‚æ•°è°ƒä¼˜æŒ‡å—

æœ¬æŒ‡å—ä»‹ç»å¦‚ä½•ä½¿ç”¨ Optuna è¿›è¡Œ SWIFT ç®—æ³•çš„è¶…å‚æ•°è°ƒä¼˜ï¼ŒåŒ…æ‹¬å¯è§†åŒ–åˆ†æå’Œæ”¶æ•›åˆ¤æ–­ã€‚

## ç›®å½•

1. [åŸºç¡€è°ƒä¼˜](#åŸºç¡€è°ƒä¼˜)
2. [å¯è§†åŒ–åˆ†æ](#å¯è§†åŒ–åˆ†æ)
3. [æ”¶æ•›åˆ¤æ–­](#æ”¶æ•›åˆ¤æ–­)
4. [è¯•éªŒæ¬¡æ•°é€‰æ‹©](#è¯•éªŒæ¬¡æ•°é€‰æ‹©)
5. [æœ€ä½³å®è·µ](#æœ€ä½³å®è·µ)

## åŸºç¡€è°ƒä¼˜

### åŸºæœ¬å‘½ä»¤

```bash
# å¼‚å¸¸è¯„åˆ†ä»»åŠ¡
.venv/bin/python ts_benchmark/tune_params_swift.py \
    --task-name score_anomalies \
    --dataset-name CalIt2 \
    --train-val-len 2520 \
    --algorithm-name swift \
    --anomaly-ratio 1.0 \
    --n-trials 50

# å¼‚å¸¸æ£€æµ‹ä»»åŠ¡
.venv/bin/python ts_benchmark/tune_params_swift.py \
    --task-name find_anomalies \
    --dataset-name PSM \
    --train-val-len 58317 \
    --algorithm-name swift \
    --anomaly-ratio 5.0 \
    --n-trials 100
```

### å‚æ•°è¯´æ˜

- `--task-name`: ä»»åŠ¡ç±»å‹ (`score_anomalies` æˆ– `find_anomalies`)
- `--dataset-name`: æ•°æ®é›†åç§°
- `--train-val-len`: è®­ç»ƒéªŒè¯é›†æ€»é•¿åº¦
- `--algorithm-name`: ç®—æ³•åç§° (`swift`)
- `--anomaly-ratio`: å¼‚å¸¸ç‡ç™¾åˆ†æ¯”
- `--n-trials`: Optuna è¯•éªŒæ¬¡æ•°
- `--restart`: å¼ºåˆ¶é‡æ–°å¼€å§‹ï¼ˆåˆ é™¤å·²æœ‰è¿›åº¦ï¼‰

## å¯è§†åŒ–åˆ†æ

### å®‰è£…ä¾èµ–

```bash
pip install plotly
```

### ç”Ÿæˆå¯è§†åŒ–å›¾è¡¨

è°ƒä¼˜å®Œæˆåï¼Œä½¿ç”¨ç‹¬ç«‹çš„å¯è§†åŒ–è„šæœ¬ï¼š

```bash
.venv/bin/python ts_benchmark/visualize_optuna.py \
    --study-db optuna_studies/score_anomalies_CalIt2_swift_ratio_1.0.db \
    --study-name score_anomalies_CalIt2_swift_ratio_1.0
```

### å¯è§†åŒ–å›¾è¡¨ç±»å‹

ç”Ÿæˆçš„ HTML æ–‡ä»¶åŒ…å«ä»¥ä¸‹äº¤äº’å¼å›¾è¡¨ï¼š

1. **optimization_history.html**: ä¼˜åŒ–å†å²
   - æ˜¾ç¤ºæ¯æ¬¡è¯•éªŒçš„ç»“æœ
   - æœ€ä½³å€¼è¶‹åŠ¿çº¿
   - ç”¨äºè§‚å¯Ÿæ•´ä½“ä¼˜åŒ–è¿›å±•

2. **param_importances.html**: å‚æ•°é‡è¦æ€§
   - æ˜¾ç¤ºå“ªäº›å‚æ•°å¯¹ç»“æœå½±å“æœ€å¤§
   - å¸®åŠ©ç†è§£æ¨¡å‹è¡Œä¸º
   - æŒ‡å¯¼åç»­è°ƒä¼˜é‡ç‚¹

3. **param_slice.html**: å‚æ•°åˆ‡ç‰‡åˆ†æ
   - æ˜¾ç¤ºå•ä¸ªå‚æ•°ä¸ç›®æ ‡å€¼çš„å…³ç³»
   - å¸®åŠ©ç†è§£å‚æ•°çš„æœ€ä¼˜èŒƒå›´

4. **parallel_coordinate.html**: å¹¶è¡Œåæ ‡å›¾
   - æ˜¾ç¤ºé«˜æ€§èƒ½è¯•éªŒçš„å‚æ•°ç»„åˆ
   - å¸®åŠ©å‘ç°å‚æ•°é—´çš„ç›¸å…³æ€§

5. **convergence_analysis.html**: æ”¶æ•›åˆ†æ
   - è‡ªå®šä¹‰æ”¶æ•›å›¾è¡¨
   - æ˜¾ç¤ºæœ€ä½³å€¼å˜åŒ–è¶‹åŠ¿
   - å¸®åŠ©åˆ¤æ–­æ˜¯å¦éœ€è¦æ›´å¤šè¯•éªŒ

## æ”¶æ•›åˆ¤æ–­

### è‡ªåŠ¨æ”¶æ•›åˆ†æ

è°ƒä¼˜è„šæœ¬ä¼šè‡ªåŠ¨åˆ†ææ”¶æ•›æƒ…å†µï¼š

```
ğŸ” æ”¶æ•›åˆ†æ:
  - æ˜¯å¦æ”¶æ•›: å¦
  - åŸå› : æ”¹è¿›ç‡è¿‡é«˜
  - æ”¹è¿›ç‡: 0.0234
  - åˆ†æè¯•éªŒæ•°: 50
```

### æ”¶æ•›æ ‡å‡†

- **æ”¹è¿›ç‡ < 0.1%**: è®¤ä¸ºå·²æ”¶æ•›
- **çª—å£å¤§å°**: é»˜è®¤åˆ†ææœ€è¿‘ 20 ä¸ªè¯•éªŒ
- **æœ€å°è¯•éªŒæ•°**: è‡³å°‘éœ€è¦ 20 ä¸ªå®Œæˆçš„è¯•éªŒ

### æ‰‹åŠ¨åˆ¤æ–­æ–¹æ³•

1. **æŸ¥çœ‹ä¼˜åŒ–å†å²å›¾**:
   - æœ€ä½³å€¼æ›²çº¿è¶‹äºå¹³ç¼“
   - æœ€è¿‘çš„è¯•éªŒå¾ˆå°‘äº§ç”Ÿæ”¹è¿›

2. **è§‚å¯Ÿå‚æ•°é‡è¦æ€§**:
   - é‡è¦å‚æ•°å·²è¢«å……åˆ†æ¢ç´¢
   - å‚æ•°èŒƒå›´è¦†ç›–åˆç†

3. **æ£€æŸ¥è¯•éªŒåˆ†å¸ƒ**:
   - é«˜æ€§èƒ½åŒºåŸŸè¢«å……åˆ†é‡‡æ ·
   - å‚æ•°ç»„åˆè¶‹äºç¨³å®š

## è¯•éªŒæ¬¡æ•°é€‰æ‹©

### æ¨èè¯•éªŒæ¬¡æ•°

ç³»ç»Ÿä¼šæ ¹æ®æ•°æ®é›†å’Œç®—æ³•è‡ªåŠ¨æ¨èè¯•éªŒæ¬¡æ•°ï¼š

```python
# åŸºç¡€è¯•éªŒæ¬¡æ•°: 50
# æ•°æ®é›†è°ƒæ•´ç³»æ•°:
#   - PSM: 2.0 (å¤§æ•°æ®é›†)
#   - MSL: 1.5 (ä¸­ç­‰æ•°æ®é›†)  
#   - CalIt2: 1.0 (å°æ•°æ®é›†)
# ç®—æ³•è°ƒæ•´ç³»æ•°:
#   - SWIFT: 1.5 (å¤æ‚ç®—æ³•)
```

### å®é™…å»ºè®®

| æ•°æ®é›† | æ¨èè¯•éªŒæ¬¡æ•° | è¯´æ˜ |
|--------|--------------|------|
| CalIt2 | 75 | å°æ•°æ®é›†ï¼Œä¸­ç­‰å¤æ‚åº¦ |
| MSL | 115 | ä¸­ç­‰æ•°æ®é›†ï¼Œéœ€è¦æ›´å¤šæ¢ç´¢ |
| PSM | 150 | å¤§æ•°æ®é›†ï¼Œå‚æ•°æ•æ„Ÿ |

### æ¸è¿›å¼è°ƒä¼˜

```bash
# ç¬¬ä¸€è½®ï¼šå¿«é€Ÿæ¢ç´¢
--n-trials 50

# ç¬¬äºŒè½®ï¼šç²¾ç»†è°ƒä¼˜ï¼ˆä¼šè‡ªåŠ¨ç»§ç»­ï¼‰
--n-trials 100

# ç¬¬ä¸‰è½®ï¼šæœ€ç»ˆä¼˜åŒ–
--n-trials 150
```

## æœ€ä½³å®è·µ

### 1. åˆ†é˜¶æ®µè°ƒä¼˜

```bash
# é˜¶æ®µ1: å¿«é€Ÿæ¢ç´¢ (50 trials)
# é˜¶æ®µ2: æ·±å…¥ä¼˜åŒ– (100 trials)  
# é˜¶æ®µ3: ç²¾ç»†è°ƒä¼˜ (150 trials)
```

### 2. ç›‘æ§æ”¶æ•›

- æ¯ 50 ä¸ªè¯•éªŒæ£€æŸ¥ä¸€æ¬¡æ”¶æ•›æƒ…å†µ
- ä½¿ç”¨å¯è§†åŒ–å›¾è¡¨è¾…åŠ©åˆ¤æ–­
- å…³æ³¨å‚æ•°é‡è¦æ€§å˜åŒ–

### 3. å‚æ•°èŒƒå›´è°ƒæ•´

å¦‚æœå‘ç°æœ€ä¼˜å€¼åœ¨è¾¹ç•Œï¼š

```python
# åœ¨ tune_params_swift.py ä¸­è°ƒæ•´ PARAM_CONFIG
"learning_rate": {
    "low": 1e-5,    # é™ä½ä¸‹ç•Œ
    "high": 1e-1,   # æé«˜ä¸Šç•Œ
}
```

### 4. ç»“æœéªŒè¯

```bash
# ä½¿ç”¨æœ€ä½³é…ç½®å¤šæ¬¡è¿è¡ŒéªŒè¯ç¨³å®šæ€§
# æ£€æŸ¥ä¸åŒæ•°æ®é›†çš„æ³›åŒ–æ€§èƒ½
```

### 5. èµ„æºç®¡ç†

- ä½¿ç”¨ `--restart` é‡æ–°å¼€å§‹
- ç›‘æ§ GPU å†…å­˜ä½¿ç”¨
- åˆç†è®¾ç½®æ‰¹é‡å¤§å°

## æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜

1. **GPU å†…å­˜ä¸è¶³**
   - å‡å° batch_size æœç´¢èŒƒå›´
   - é™ä½æ¨¡å‹å¤æ‚åº¦å‚æ•°

2. **æ”¶æ•›è¿‡æ…¢**
   - å¢åŠ è¯•éªŒæ¬¡æ•°
   - è°ƒæ•´å‚æ•°æœç´¢èŒƒå›´
   - æ£€æŸ¥æ•°æ®è´¨é‡

3. **å¯è§†åŒ–å¤±è´¥**
   - ç¡®ä¿å®‰è£…äº† plotly
   - æ£€æŸ¥æ•°æ®åº“æ–‡ä»¶å®Œæ•´æ€§

### æ€§èƒ½ä¼˜åŒ–

- ä½¿ç”¨ TPE é‡‡æ ·å™¨ï¼ˆé»˜è®¤ï¼‰
- å¯ç”¨ MedianPrunerï¼ˆé»˜è®¤ï¼‰
- åˆç†è®¾ç½®æ—©åœå‚æ•°

## ç¤ºä¾‹å·¥ä½œæµ

```bash
# 1. è¿è¡Œå®Œæ•´çš„è°ƒä¼˜+å¯è§†åŒ–æµç¨‹
bash scripts/tuning/example_with_visualization.sh

# 2. æŸ¥çœ‹ç»“æœ
open optuna_visualizations/CalIt2/swift/optimization_history.html

# 3. æ ¹æ®æ”¶æ•›æƒ…å†µå†³å®šæ˜¯å¦ç»§ç»­
# å¦‚æœæœªæ”¶æ•›ï¼Œå¢åŠ è¯•éªŒæ¬¡æ•°ç»§ç»­è°ƒä¼˜
```

è¿™ä¸ªå·¥ä½œæµç¨‹èƒ½å¤Ÿå¸®åŠ©æ‚¨ç³»ç»Ÿåœ°è¿›è¡Œè¶…å‚æ•°è°ƒä¼˜ï¼Œå¹¶é€šè¿‡å¯è§†åŒ–åˆ†æåšå‡ºæ˜æ™ºçš„å†³ç­–ã€‚ 